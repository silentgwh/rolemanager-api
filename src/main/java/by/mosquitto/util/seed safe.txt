-- 1. Создание профиля и роли SYSADMIN
INSERT INTO profile (name, comment, user_corr)
VALUES ('SYSADMIN_PROFILE', 'Профиль системного администратора', NULL);

INSERT INTO role (name, type, comment, user_corr)
VALUES ('SYSADMIN', 1, 'Системный администратор', NULL);

-- 2. Связь профиля и роли SYSADMIN
INSERT INTO profile_role (id_prof, id_role)
VALUES (
    (SELECT id FROM profile WHERE name = 'SYSADMIN_PROFILE'),
    (SELECT id FROM role WHERE name = 'SYSADMIN')
);

-- 3. Создание пользователя SYSADMIN
INSERT INTO users (username, password, profile_id, role_id)
VALUES (
    'sysadmin',
    '$2a$10$7QeW9ZQwYxvKxU9eTzFZ3eKZzU9eTzFZ3eKZzU9eTzFZ3eKZzU9eTzFZ3e', -- bcrypt-хеш пароля "admin123"
    (SELECT id FROM profile WHERE name = 'SYSADMIN_PROFILE'),
    (SELECT id FROM role WHERE name = 'SYSADMIN')
);

-- 4. Привилегии, привязанные к пользователю SYSADMIN
INSERT INTO privilege (name, type, name_2, comment, user_corr, is_private)
VALUES
('MANAGE_USERS', 1, 'Управление пользователями', 'Создание и удаление пользователей',
    (SELECT id FROM users WHERE username = 'sysadmin'), false),
('VIEW_REPORTS', 0, 'Просмотр отчётов', 'Доступ к аналитике',
    (SELECT id FROM users WHERE username = 'sysadmin'), false);

-- 5. Создание роли ADMIN, привязанной к SYSADMIN
INSERT INTO role (name, type, comment, user_corr)
VALUES ('ADMIN', 0, 'Администратор системы',
    (SELECT id FROM users WHERE username = 'sysadmin'));

-- 6. Связь роли ADMIN с привилегиями
INSERT INTO role_privilege (id_role, id_priv)
VALUES
((SELECT id FROM role WHERE name = 'ADMIN'), (SELECT id FROM privilege WHERE name = 'MANAGE_USERS')),
((SELECT id FROM role WHERE name = 'ADMIN'), (SELECT id FROM privilege WHERE name = 'VIEW_REPORTS'));

-- 7. Создание профиля ADMIN, привязанного к SYSADMIN
INSERT INTO profile (name, comment, user_corr)
VALUES ('ADMIN_PROFILE', 'Профиль администратора',
    (SELECT id FROM users WHERE username = 'sysadmin'));

-- 8. Связь профиля ADMIN с ролью ADMIN
INSERT INTO profile_role (id_prof, id_role)
VALUES (
    (SELECT id FROM profile WHERE name = 'ADMIN_PROFILE'),
    (SELECT id FROM role WHERE name = 'ADMIN')
);
